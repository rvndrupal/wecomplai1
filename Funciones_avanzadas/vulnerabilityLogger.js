// vulnerabilityLogger.js - Sistema de registro de vulnerabilidades

function logVulnerabilidad(datos) {
    // Registrar en global para los reportes
    global.vulnerabilidadesDetectadas = global.vulnerabilidadesDetectadas || [];
    global.vulnerabilidadesDetectadas.push({
        matriz: datos.matriz || 'Desconocida',
        test: datos.test || 'Desconocido',
        tipo: datos.tipo || 'Desconocido',
        severidad: datos.severidad || 'MEDIA',
        payload: datos.payload || '',
        impacto: datos.impacto || '',
        riesgo: datos.riesgo || '',
        ubicacion: datos.ubicacion || '',
        recomendacion: datos.recomendacion || '',
        owasp: datos.owasp || '',
        timestamp: new Date().toISOString()
    });

    // Log visual en consola
    const emoji = datos.severidad === 'CR√çTICA' ? 'üö®' : 
                  datos.severidad === 'ALTA' ? '‚ö†Ô∏è' : '‚ö°';
    
    console.log('\n========================================');
    console.log(`${emoji} VULNERABILIDAD ${datos.severidad} DETECTADA ${emoji}`);
    console.log('========================================');
    console.log(`Tipo: ${datos.tipo}`);
    if (datos.payload) console.log(`Payload: ${datos.payload.substring(0, 100)}${datos.payload.length > 100 ? '...' : ''}`);
    console.log(`Severidad: ${datos.severidad}`);
    if (datos.impacto) console.log(`Impacto: ${datos.impacto}`);
    if (datos.riesgo) console.log(`Riesgo: ${datos.riesgo}`);
    if (datos.ubicacion) console.log(`Ubicaci√≥n: ${datos.ubicacion}`);
    if (datos.recomendacion) console.log(`Recomendaci√≥n: ${datos.recomendacion}`);
    if (datos.owasp) console.log(`OWASP: ${datos.owasp}`);
    console.log('========================================\n');
}

module.exports = { logVulnerabilidad };
